# Лекция 1. Основы C# и .NET. Типы данных в C#

**Цель лекции:** Понять взаимосвязь между C# и платформой .NET, изучить фундаментальную систему типов данных в C# и научиться применять эти знания для объявления переменных и работы с ними.

---

### **План лекции:**

1.  **Введение в экосистему .NET и C#**
    *   Что такое .NET?
    *   Архитектура .NET: CLR, CTS, CLS, FCL.
    *   C# как основной язык для .NET.
2.  **Типы данных в C#**
    *   Общая система типов (Value Types и Reference Types).
    *   Значимые типы (Value Types):
        *   Целочисленные типы.
        *   Типы с плавающей запятой.
        *   Тип `decimal`.
        *   Тип `bool`.
        *   Тип `char`.
        *   Структуры и перечисления (`struct`, `enum`).
    *   Ссылочные типы (Reference Types):
        *   Классы (`class`).
        *   Тип `string`.
        *   Тип `object`.
        *   Массивы (`Array`).
        *   Делегаты (`delegate`).
    *   Ключевое слово `var`.
3.  **Резюме**
4.  **Контрольные вопросы**

---

### **1. Введение в экосистему .NET и C#**

#### **Что такое .NET?**

**.NET (Dot Net)** — это не язык программирования, а целая кроссплатформенная, открытая платформа для разработки разнообразных приложений. Вы можете создавать веб-приложения (ASP.NET Core), desktop-приложения (Windows Forms, WPF), мобильные приложения (Xamarin), игры (Unity), облачные сервисы и многое другое.

**Аналогия:** Представьте, что .NET — это фабрика по производству автомобилей. На этой фабрике есть:
*   **Конвейер и правила (CLR)** — то, что заставляет все детали работать вместе.
*   **Стандарты на детали (CTS)** — гарантия, что все винты и гайки подходят друг к другу.
*   **Склад готовых запчастей (FCL)** — огромный набор готовых компонентов (двери, двигатели, стекла).

#### **Архитектура .NET**

1.  **Common Language Runtime (CLR) — Среда выполнения**
    *   Это "виртуальная машина", "сердце" .NET. CLR управляет выполнением .NET-программ.
    *   **Основные функции:**
        *   **Управление памятью (Garbage Collection):** Автоматически освобождает память, занятую неиспользуемыми объектами.
        *   **JIT-компиляция (Just-In-Time):** Компилирует промежуточный байт-код (IL) в машинный код конкретного процессора прямо во время выполнения программы. Это обеспечивает высокую производительность и переносимость.
        *   **Обработка исключений:** Предоставляет единый механизм для обработки ошибок.
        *   **Безопасность:** Проверяет код на корректность.

2.  **Common Type System (CTS) — Общая система типов**
    *   Это стандарт, который определяет, какие типы данных могут быть созданы в .NET и как они будут себя вести. CTS гарантирует, что объекты, созданные на разных языках .NET (C#, F#, VB.NET), могут беспрепятственно взаимодействовать друг с другом. Например, тип `int` в C# и `Integer` в VB.NET — это один и тот же тип `System.Int32` из CTS.

3.  **Framework Class Library (FCL) / Base Class Library (BCL) — Библиотека классов**
    *   Это огромная коллекция готовых, протестированных классов, интерфейсов и типов значений, которые предоставляют доступ к системным функциям.
    *   **Примеры пространств имен:**
        *   `System` — базовые типы (`String`, `Int32`, `Console`).
        *   `System.IO` — работа с файлами и потоками.
        *   `System.Data` — работа с базами данных.
        *   `System.Net` — сетевое взаимодействие.

#### **C# как основной язык для .NET**

**C# (C Sharp)** — это современный, объектно-ориентированный язык программирования, созданный компанией Microsoft специально для платформы .NET. Он является основным, но не единственным языком для .NET.

**Процесс от исходного кода до исполнения:**
1.  Вы пишете код на C# (файл `.cs`).
2.  Компилятор C# компилирует его в **промежуточный язык (IL, Intermediate Language)** и сохраняет в сборку (файл `.exe` или `.dll`).
3.  При запуске программы CLR загружает сборку и с помощью **JIT-компилятора** преобразует IL в машинный код для конкретного процессора.
4.  Машинный код выполняется.

---

### **2. Типы данных в C#**

В C# каждая переменная и константа имеет тип. Система типов в C# является **единой**, но для понимания ее делят на две большие категории, которые различаются по способу хранения в памяти.

#### **Общая система типов (Value Types и Reference Types)**

*   **Значимые типы (Value Types):**
    *   Хранят **непосредственно свои данные**.
    *   Размещаются в области памяти **стек (stack)**.
    *   При присваивании одной переменной другой **копируется значение**.
    *   К ним относятся все числовые типы, `bool`, `char`, структуры (`struct`), перечисления (`enum`).

*   **Ссылочные типы (Reference Types):**
    *   Хранят **ссылку (адрес в памяти)** на свои данные.
    *   Данные (объекты) размещаются в управляемой **куче (heap)**.
    *   При присваивании одной переменной другой **копируется ссылка** (обе переменные начинают указывать на один и тот же объект в куче).
    *   К ним относятся классы (`class`), строки (`string`), массивы (`Array`), делегаты (`delegate`), интерфейсы (`interface`).

**Простая аналогия:**
*   **Value Type** — это как документ, который вы держите в руках. Если вы сделаете копию и отдадите другу, у каждого будет своя независимая копия.
*   **Reference Type** — это как документ, лежащий в сейфе (куча). У вас есть ключ от сейфа (ссылка). Если вы сделаете копию ключа и отдадите другу, вы оба сможете открыть один и тот же сейф и изменять один и тот же документ.

#### **Значимые типы (Value Types)**

##### **Целочисленные типы**

| Тип C#  | Тип .NET   | Размер  | Диапазон                                       | Пример использования                      |
| --------- | ---------- | ------- | ---------------------------------------------- | ----------------------------------------- |
| `sbyte`   | `System.SByte`  | 1 байт  | -128 ... 127                                   | `sbyte temperature = -25;`                |
| `byte`    | `System.Byte`   | 1 байт  | 0 ... 255                                      | `byte pixelValue = 0xFF;` // Шестнадцатеричный формат |
| `short`   | `System.Int16`  | 2 байта | -32,768 ... 32,767                             | `short populationChange = -1500;`         |
| `ushort`  | `System.UInt16` | 2 байта | 0 ... 65,535                                   | `ushort year = 2024;`                     |
| `int`     | `System.Int32`  | 4 байта | -2.1×10⁹ ... 2.1×10⁹                           | `int totalUsers = 1_000_000;` // Использование `_` как разделителя |
| `uint`    | `System.UInt32` | 4 байта | 0 ... 4.3×10⁹                                  | `uint distanceToSunKm = 150_000_000;`     |
| `long`    | `System.Int64`  | 8 байт  | -9.2×10¹⁸ ... 9.2×10¹⁸                         | `long worldPopulation = 8_000_000_000;`   |
| `ulong`   | `System.UInt64` | 8 байт  | 0 ... 1.8×10¹⁹                                 | `ulong atomsInUniverse = 10_000_000_000;` |

**По умолчанию для целых чисел используется `int`.**

##### **Типы с плавающей запятой**

Используются для представления дробных чисел. **Не подходят для финансовых расчетов** из-за ошибок округления.

| Тип C# | Тип .NET    | Размер  | Точность           | Пример использования                      |
| -------- | ----------- | ------- | ------------------ | ----------------------------------------- |
| `float`  | `System.Single` | 4 байта | ~6-9 значащих цифр | `float pi = 3.14159265f;` // Суффикс `f` обязателен! |
| `double` | `System.Double` | 8 байт  | ~15-17 значащих цифр | `double preciseMeasurement = 1.23456789012345;` |

**По умолчанию для дробных чисел используется `double`.**

##### **Тип `decimal`**

*   **Тип .NET:** `System.Decimal`
*   **Размер:** 16 байт.
*   **Предназначение:** Для финансовых и денежных расчетов, где важна точность.
*   **Пример:**
    ```csharp
    decimal salary = 75000.50m; // Суффикс `m` обязателен!
    decimal price = 19.99m;
    decimal total = salary + price;
    ```

##### **Тип `bool`**

*   **Тип .NET:** `System.Boolean`
*   **Размер:** Зависит от реализации (обычно 1-4 байта).
*   **Значения:** `true` или `false`.
*   **Пример:**
    ```csharp
    bool isUserLoggedIn = true;
    bool isFileAvailable = false;
    bool isEqual = (10 > 5); // Результат сравнения - true
    ```

##### **Тип `char`**

*   **Тип .NET:** `System.Char`
*   **Размер:** 2 байта (кодировка Unicode).
*   **Представляет:** Один символ.
*   **Пример:**
    ```csharp
    char grade = 'A';
    char newLine = '\n'; // Управляющая последовательность
    char tab = '\t';
    char unicodeChar = '\u0061'; // Символ 'a' в Unicode
    ```

##### **Структуры (`struct`) и перечисления (`enum`)**

*   **`struct`:** Позволяет создавать собственные значимые типы для группировки связанных данных.
    ```csharp
    struct Point
    {
        public int X;
        public int Y;
    }

    // Использование
    Point p1;
    p1.X = 10;
    p1.Y = 20;
    Point p2 = p1; // Происходит ПОЛНОЕ КОПИРОВАНИЕ всех данных
    p2.X = 100; // p1.X останется равным 10
    ```

*   **`enum`:** Набор именованных целочисленных констант.
    ```csharp
    enum DayOfWeek
    {
        Monday,    // 0
        Tuesday,   // 1
        Wednesday, // 2
        Thursday,  // 3
        Friday,    // 4
        Saturday,  // 5
        Sunday     // 6
    }

    // Использование
    DayOfWeek today = DayOfWeek.Friday;
    if (today == DayOfWeek.Saturday || today == DayOfWeek.Sunday)
    {
        Console.WriteLine("Выходной!");
    }
    ```

#### **Ссылочные типы (Reference Types)**

##### **Классы (`class`)**

Это основа объектно-ориентированного программирования в C#. Класс определяет шаблон для создания объектов.

```csharp
class Person
{
    public string Name;
    public int Age;
}

// Использование
Person person1 = new Person(); // 'new' создает объект в куче
person1.Name = "Alice";
person1.Age = 25;

Person person2 = person1; // Копируется ССЫЛКА, а не данные
person2.Name = "Bob";

Console.WriteLine(person1.Name); // Выведет "Bob", т.к. person1 и person2 указывают на один объект!
```

##### **Тип `string`**

*   **Тип .NET:** `System.String`
*   **Особенности:**
    *   Это ссылочный тип, но он обладает **некоторой семантикой значимого типа** (неизменяемость).
    *   **Неизменяемый (immutable):** Любая операция, "изменяющая" строку, на самом деле создает **новую** строку.
    *   Для работы с изменяемыми "строками" используется `StringBuilder`.

```csharp
string greeting = "Hello";
greeting = greeting + ", World!"; // Создается НОВАЯ строка в памяти.

string path1 = "C:\\Windows\\System32"; // Экранирование
string path2 = @"C:\Windows\System32";  // Дословная строка (verbatim)
```

##### **Тип `object`**

*   **Тип .NET:** `System.Object`
*   Это **базовый тип для всех типов в .NET**. Любой класс, структура, число, строка неявно наследуются от `object`.
*   Может хранить значение любого типа (так работает `var` и `dynamic` "под капотом").

```csharp
object obj1 = 10;        // Упаковка (Boxing): int -> object
object obj2 = "Hello";   // string -> object
object obj3 = new Person();

// Чтобы получить исходное значение, нужно распаковать (Unboxing)
int number = (int)obj1; // Распаковка (требует явного приведения типа)
```

##### **Массивы (`Array`)**

Массив — это структура данных, содержащая несколько элементов одного типа.

```csharp
// Объявление и инициализация массива
int[] numbers = new int[5] { 1, 2, 3, 4, 5 };
string[] names = new string[] { "Alice", "Bob", "Charlie" };

// Доступ к элементам
int firstNumber = numbers[0]; // 1
numbers[1] = 20; // Изменение второго элемента

// Массив массивов (зубчатый массив)
int[][] jaggedArray = new int[3][];
jaggedArray[0] = new int[] { 1, 2 };
jaggedArray[1] = new int[] { 3, 4, 5 };
```

#### **Ключевое слово `var`**

`var` позволяет объявить переменную **без явного указания типа**. Компилятор сам определяет тип на основе инициализирующего выражения.

```csharp
var number = 10;        // компилятор видит int
var name = "Alice";     // компилятор видит string
var isActive = true;    // компилятор видит bool
var person = new Person(); // компилятор видит Person

// var error; // ОШИБКА! Переменная с var должна быть сразу инициализирована.
```

**Важно:** `var` не делает язык динамическим. Тип фиксируется на этапе компиляции и потом измениться не может.

---

### **3. Резюме**

1.  **.NET** — это кроссплатформенная платформа для разработки, сердцем которой является **CLR**, управляющая выполнением кода.
2.  **C#** — основной язык для .NET, который компилируется в промежуточный язык (IL) и затем в машинный код с помощью JIT-компилятора CLR.
3.  Система типов в C# единая, но делится на **Value Types** (хранятся в стеке, копируются по значению) и **Reference Types** (хранятся в куче, копируются по ссылке).
4.  К **значимым типам** относятся:
    *   Целочисленные (`int`, `long` и т.д.).
    *   С плавающей запятой (`float`, `double`).
    *   `decimal` (для точных расчетов).
    *   `bool` и `char`.
    *   Пользовательские `struct` и `enum`.
5.  К **ссылочным типам** относятся:
    *   Классы (`class`).
    *   `string` (неизменяемый тип).
    *   `object` (базовый тип для всех).
    *   Массивы (`Array`).
6.  Ключевое слово **`var`** упрощает объявление переменных, когда тип очевиден из правой части выражения, но не отменяет строгую типизацию.

---

### **4. Контрольные вопросы**

1.  В чем заключается основная роль Common Language Runtime (CLR) в экосистеме .NET?
2.  Объясните разницу между значимыми (Value Types) и ссылочными (Reference Types) типами. Приведите примеры каждого.
3.  Что произойдет в памяти, если выполнить следующий код? Объясните, почему.
    ```csharp
    int a = 5;
    int b = a;
    b = 10;
    // Чему равно значение 'a' теперь?
    ```
4.  А что произойдет в этом случае?
    ```csharp
    class MyClass { public int Value; }
    MyClass obj1 = new MyClass() { Value = 5 };
    MyClass obj2 = obj1;
    obj2.Value = 10;
    // Чему равно значение obj1.Value теперь?
    ```
5.  Почему для финансовых расчетов рекомендуется использовать тип `decimal`, а не `double` или `float`?
6.  Что означает "неизменяемость" (immutability) типа `string`? Каковы практические последствия этого?
7.  Каков результат компиляции следующей строки? Почему?
    ```csharp
    var number; // Будет ли это работать?
    ```
8.  Что такое упаковка (Boxing) и распаковка (Unboxing)? В чем их потенциальная "цена" для производительности?
9.  Какой тип .NET скрывается за ключевым словом `int` в C#? А за `string`?
10. Для чего используется суффикс `f` при инициализации переменной типа `float` и суффикс `m` для `decimal`? Что будет, если их опустить?