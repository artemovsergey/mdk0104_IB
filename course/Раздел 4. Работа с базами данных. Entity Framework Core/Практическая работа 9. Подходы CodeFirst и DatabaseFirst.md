# Практическая работа 9. Подходы Code-First и Database-First

### Цель работы

Научиться использовать два подхода работы с базой данных в Entity Framework Core: **Code-First** и **Database-First**. Освоить создание моделей, контекста и генерацию базы данных, а также обратное создание моделей из существующей базы данных.

---

## **Теоретическая часть**

### **1. Подход Code-First**

* **Суть:** сначала создаются классы C# (модели), потом EF Core генерирует базу данных.
* **Преимущества:**

  * Полный контроль над моделями через код
  * Легко управлять версионированием через миграции
* **Недостатки:**

  * Требует знания EF Core и конфигурации моделей
* **Этапы работы:**

  1. Создать классы-сущности
  2. Создать DbContext
  3. Настроить подключение к базе данных
  4. Создать миграцию и применить её (`Add-Migration`, `Update-Database`)

**Пример модели и контекста:**

```csharp
using Microsoft.EntityFrameworkCore;

public class Student
{
    public int Id { get; set; }
    public string Name { get; set; }
    public int Age { get; set; }
}

public class SchoolContext : DbContext
{
    public DbSet<Student> Students { get; set; }

    protected override void OnConfiguring(DbContextOptionsBuilder optionsBuilder)
    {
        optionsBuilder.UseSqlite("Data Source=school.db");
    }
}
```

---

### **2. Подход Database-First**

* **Суть:** база данных создаётся заранее, а модели и контекст генерируются из неё.
* **Преимущества:**

  * Можно работать с уже существующей базой данных
  * Быстро получить C# модели без ручного описания
* **Недостатки:**

  * Меньший контроль над структурами
  * Обновление модели при изменении БД требует повторной генерации
* **Этапы работы:**

  1. Создать базу данных и таблицы (SQL Server, SQLite и др.)
  2. Использовать команду Scaffold-DbContext для генерации моделей

     ```powershell
     Scaffold-DbContext "Data Source=school.db" Microsoft.EntityFrameworkCore.Sqlite -OutputDir Models
     ```

---

## **Ход работы**

### **1. Code-First**

1. Создать проект `CodeFirstDemo`.
2. Создать классы-сущности `Student`, `Course`, `Enrollment`.
3. Создать контекст `SchoolContext`.
4. Настроить подключение к базе данных SQLite.
5. Создать и применить миграцию:

   ```powershell
   Add-Migration InitialCreate
   Update-Database
   ```
6. Добавить, прочитать и удалить записи через DbContext.

### **2. Database-First**

1. Создать базу данных `school.db` с таблицей `Students`.
2. Сгенерировать модели через команду Scaffold-DbContext.
3. Создать консольное приложение `DatabaseFirstDemo`.
4. Использовать сгенерированный DbContext для выполнения CRUD-операций.

---

## **Пример практического задания**

**Задание:**

1. Создать проект `CodeFirstDemo`:

   * Модели: `Student` (Id, Name, Age), `Course` (Id, Title)
   * Связь многие-ко-многим через `Enrollment`
   * Добавить 2–3 записи студентов и курсов
   * Вывести список студентов и их курсов

2. Создать проект `DatabaseFirstDemo`:

   * Использовать существующую базу данных с таблицей `Students`
   * Сгенерировать модели и DbContext
   * Вывести всех студентов на экран
   * Добавить нового студента и сохранить изменения

---

## **Пример кода (Code-First)**

```csharp
using System;
using System.Linq;
using Microsoft.EntityFrameworkCore;

public class Student
{
    public int Id { get; set; }
    public string Name { get; set; }
    public int Age { get; set; }
}

public class SchoolContext : DbContext
{
    public DbSet<Student> Students { get; set; }

    protected override void OnConfiguring(DbContextOptionsBuilder optionsBuilder)
    {
        optionsBuilder.UseSqlite("Data Source=school.db");
    }
}

class Program
{
    static void Main()
    {
        using var context = new SchoolContext();
        context.Database.EnsureCreated();

        context.Students.Add(new Student { Name = "Alice", Age = 20 });
        context.Students.Add(new Student { Name = "Bob", Age = 22 });
        context.SaveChanges();

        var students = context.Students.ToList();
        foreach (var s in students)
            Console.WriteLine($"{s.Id}: {s.Name}, {s.Age}");
    }
}
```

---

## **Критерии оценки**

| Оценка | Критерий                                                                            |
| ------ | ----------------------------------------------------------------------------------- |
| 2      | Выполнено только одно задание, частично работает CRUD                               |
| 3      | Реализован Code-First или Database-First, корректная работа с БД                    |
| 4      | Выполнены оба подхода, все операции CRUD работают корректно                         |
| 5      | Отличная реализация обоих подходов, аккуратный код, скриншоты и readme присутствуют |

---

## **Контрольные вопросы**

1. Чем Code-First отличается от Database-First?
2. Когда удобнее использовать Code-First, а когда Database-First?
3. Как создать миграцию и применить её в Code-First?
4. Как сгенерировать модели из существующей базы данных?
5. Какие преимущества даёт использование ORM в C#?

---

## **Структура репозитория**

```
EntityFrameworkDemo/
│
├── CodeFirstDemo/
│   ├── CodeFirstDemo.sln
│   ├── Program.cs
│   └── SchoolContext.cs
│
├── DatabaseFirstDemo/
│   ├── DatabaseFirstDemo.sln
│   ├── Program.cs
│   └── Models/ (сгенерированные модели)
│
├── images/
│   ├── screenshot_codefirst.png
│   └── screenshot_databasefirst.png
│
└── readme.md
```

### **Пример readme.md**

````markdown
# Практическая работа №9

**Тема:** Подходы Code-First и Database-First

## Задание
1. Code-First:
   - Создать модели Student, Course, Enrollment
   - Создать контекст SchoolContext
   - Добавить и вывести студентов и курсы
2. Database-First:
   - Использовать существующую базу данных с таблицей Students
   - Сгенерировать модели и DbContext
   - Добавить нового студента и вывести всех студентов

## Пример кода
```csharp
// Пример Code-First приведен выше
````

```